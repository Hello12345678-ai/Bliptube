<!DOCTYPE html>
<html>
<head>
    <title>BlipTube Settings</title>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            display: flex;
            background-color: #1a133d; /* default dark-blue */
            color: #b0b0ff;
        }
        /* Sidebar */
        #sidebar {
            width: 220px;
            background-color: #1a133d;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh;
        }
        #profilePic {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background-color: #7158ff;
            margin-bottom: 20px;
            object-fit: cover;
        }
        .option {
            width: 100%;
            text-align: center;
            padding: 10px;
            margin-bottom: 10px;
            cursor: pointer;
            border-radius: 5px;
            background-color: #2c254f;
        }
        .option:hover {
            background-color: #7158ff;
        }
        /* Main content */
        #mainContent {
            flex: 1;
            padding: 30px;
        }
        h1 {
            margin-top: 0;
        }
        button {
            padding: 10px 15px;
            border-radius: 5px;
            border: none;
            background-color: #7158ff;
            color: white;
            cursor: pointer;
            margin: 5px 0;
        }
        button:hover {
            background-color: #8a6cff;
        }
        input[type="file"] { display: none; }
    </style>
</head>
<body>
    <div id="sidebar">
        <img id="profilePic" src="" alt="Profile Picture">
        <label for="profileUpload" style="cursor:pointer;">Change Picture</label>
        <input type="file" id="profileUpload" accept="image/*">
        <div class="option" id="settingsOption">Settings</div>
        <div class="option" id="accountOption">Account</div>
    </div>

    <div id="mainContent"> 
        <button id="goBackBtn">&larr; Go Back</button>
        <h1>Welcome to Settings</h1>
        <p>Select an option from the left to configure BlipTube.</p>
    </div>
    <script src="script.js"></script>
    <script>
const username = localStorage.getItem("userUsername");
const profilePic = document.getElementById("profilePic");
const profileUpload = document.getElementById("profileUpload");

// Load users and deleted users
const users = JSON.parse(localStorage.getItem("users") || "{}");
const deletedUsers = JSON.parse(localStorage.getItem("deletedUsers") || "[]");

// Redirect to login if not logged in
if (!username || !users[username] || deletedUsers.includes(username)) {
    window.location.href = "Login.html";
}

// Load saved profile picture for this user
if (users[username]?.profilePic) {
    profilePic.src = users[username].profilePic;
}

// Change profile picture (per-user)
profileUpload.addEventListener("change", () => {
    const file = profileUpload.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = () => {
            const imgData = reader.result;
            profilePic.src = imgData;

            // Save picture to the user's data
            users[username].profilePic = imgData;
            localStorage.setItem("users", JSON.stringify(users));
        };
        reader.readAsDataURL(file);
    }
});

// Sidebar & navigation
const mainContent = document.getElementById("mainContent");

// Go Back button
document.getElementById("goBackBtn").addEventListener("click", () => {
    window.location.href = "../Main.html";
});

// Settings option
document.getElementById("settingsOption").addEventListener("click", () => {
    mainContent.innerHTML = `
        <button id="goBackBtn">&larr; Go Back</button>
        <h1>Settings</h1>
        <p>Configure your BlipTube preferences here.</p>
    `;
    document.getElementById("goBackBtn").addEventListener("click", () => {
        window.location.href = "../Main.html";
    });
});

// Account option
document.getElementById("accountOption").addEventListener("click", () => {
    mainContent.innerHTML = `
        <button id="goBackBtn">&larr; Go Back</button>
        <h1>Account</h1>
        <button id="logoutBtn">Logout</button>
        <h3>Delete Account</h3>
        <input type="password" id="deletePass" placeholder="Enter password" />
        <button id="deleteBtn">Delete Account</button>
    `;

    document.getElementById("goBackBtn").addEventListener("click", () => {
        window.location.href = "../Main.html";
    });

    // Logout
    document.getElementById("logoutBtn").addEventListener("click", () => {
        localStorage.removeItem("userUsername");
        window.location.href = "Login.html";
    });

    // Delete account
    document.getElementById("deleteBtn").addEventListener("click", () => {
        const pass = document.getElementById("deletePass").value;
        const users = JSON.parse(localStorage.getItem("users") || "{}");
        let deletedUsers = JSON.parse(localStorage.getItem("deletedUsers") || "[]");

        if (users[username] && users[username].password === pass) {
            // Remove user data and picture
            delete users[username];
            deletedUsers.push(username);

            localStorage.setItem("users", JSON.stringify(users));
            localStorage.setItem("deletedUsers", JSON.stringify(deletedUsers));
            localStorage.removeItem("userUsername");

            alert("Account deleted permanently. This username can never be used again.");
            window.location.href = "Login.html";
        } else {
            alert("Incorrect password.");
        }
    });
});
    </script>
</body>
</html>